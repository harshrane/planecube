<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script>
    // Improved component for user movement with collision handling
    AFRAME.registerComponent('user-movement', {
      init: function () {
        const user = document.querySelector('#utilisateur');

        this.el.addEventListener("thumbstickmoved", function (event) {
          const movement = new THREE.Vector3(event.detail.x, 0, -event.detail.y); // Adjust z-axis movement based on preference

          // Check for collisions before applying movement
          const collisions = user.components.collision.getCollisions();
          if (collisions.length === 0) {
            user.object3D.position.add(movement.divideScalar(20)); // Adjust movement speed as needed
          }
        });
      }
    });

    // Improved component for controller visibility based on collision
    AFRAME.registerComponent('controller-visibility', {
      init: function () {
        const controller = this.el;

        this.el.addEventListener("collisionenter", function () {
          controller.setAttribute('visible', false);
        });

        this.el.addEventListener("collisionleave", function () {
          controller.setAttribute('visible', true);
        });
      }
    });
  </script>
</head>

<body>
  <a-scene renderer="antialias: true">
    <a-entity id="utilisateur" position="0 0 0" movement-controls collision>
      <a-entity camera position="0 1.5 1" look-controls></a-entity>
      <a-entity oculus-touch-controls="hand: left" controller-visibility gauche></a-entity>
      <a-entity oculus-touch-controls="hand: right" controller-visibility droite></a-entity>
    </a-entity>

    <a-plane width="10" height="10" color="#999999" position="0 0 0" rotation="-90 0 0"></a-plane>
    <a-entity gltf-model="url(scene.gltf)" position="0 0.5 -2" scale="1 1 1"></a-entity>
    <a-box id="boite1" position="-2 0.5 -3" color="blue"></a-box>
    <a-box id="boite2" position="0 0.5 -3" color="blue"></a-box>
    <a-box id="boite3" position="2 0.5 -3" color="blue"></a-box>
  </a-scene>
</body>

</html>
